name: Ping MongoDB

on:
  schedule:
    - cron: '0 */12 * * *'  # Every 12 hours
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Install mongodb package
      run: npm install mongodb
    
    
    - name: Ping MongoDB
      env:
        MONGO_URI: ${{ secrets.MONGO_URI }}
      run: |
        node -e "
          const { MongoClient } = require('mongodb');
          
          const uri = process.env.MONGO_URI;
          
          async function ping() {
            const client = new MongoClient(uri);
            try {
              await client.connect();
              await client.db('admin').command({ ping: 1 });
              console.log('Pinged MongoDB Atlas cluster successfully');
            } catch (error) {
              console.error(error);
              throw error;
            } finally {
              await client.close();
            }
          }
          
          ping();
        "